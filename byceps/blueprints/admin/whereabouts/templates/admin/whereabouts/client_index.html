{% extends 'layout/admin/whereabouts.html' %}
{% from 'macros/admin.html' import render_extra_in_heading %}
{% from 'macros/icons.html' import render_icon %}
{% from 'macros/misc.html' import render_tag %}
{% set current_page = 'whereabouts_admin' %}
{% set current_tab = 'clients' %}
{% set page_title = 'Clients' %}

{% macro render_authority_status_icon(status_name) %}
  {%- if status_name == 'pending' -%}
  {{ render_tag('', icon='pending', title=_('pending'), class='color-info icon-only') }}
  {%- elif status_name == 'approved' -%}
  {{ render_tag('', icon='enabled', title=_('approved'), class='color-success icon-only') }}
  {%- elif status_name == 'deleted' -%}
  {{ render_tag('', icon='delete', title=_('deleted'), class='color-disabled icon-only') }}
  {%- endif -%}
{%- endmacro %}

{% macro render_client_id(client) -%}
  <abbr title="{{ client.id }}">{{ client.id.hex[-12:] }}</abbr>
{%- endmacro %}

{% macro render_interactivity(client) -%}
  {{ client.button_count }} {{ _('buttons') }}
  {%- if client.audio_output %}, {{ _('audio output') }}{% endif %}
{%- endmacro %}

{% block body %}

{%- if pending_clients %}
<h2 class="title">{{ render_authority_status_icon('pending') }} {{ _('Pending Clients') }} {{ render_extra_in_heading(pending_clients|length) }}</h2>

<table class="itemlist is-vcentered is-wide">
  <thead>
    <tr>
      <th>{{ _('ID') }}</th>
      <th>{{ _('Registered at') }}</th>
      <th class="centered">{{ _('Interactivity') }}<br></th>
    </tr>
  </thead>
  <tbody>
    {%- for client in pending_clients|sort(attribute='registered_at', reverse=True) %}
    <tr>
      <td>{{ render_client_id(client) }}</td>
      <td><time datetime="{{ client.registered_at.isoformat() }}" title="{{ client.registered_at|datetimeformat }}">{{ _('since') }} {{ client.registered_at|timedeltaformat }}</time></td>
      <td class="centered">{{ render_interactivity(client) }}</td>
    </tr>
    {%- endfor %}
  </tbody>
</table>
{%- endif %}

{%- if approved_clients %}
<h2 class="title">{{ render_authority_status_icon('approved') }} {{ _('Approved Clients') }} {{ render_extra_in_heading(approved_clients|length) }}</h2>

<table class="itemlist is-vcentered is-wide">
  <thead>
    <tr>
      <th>{{ _('ID') }}</th>
      <th class="nowrap">{{ _('Registered at') }}</th>
      <th class="centered">{{ _('Interactivity') }}<br></th>
      <th>{{ _('Location') }}<br>{{ _('Description') }}</th>
    </tr>
  </thead>
  <tbody>
    {%- for client in approved_clients|sort(attribute='registered_at', reverse=True) %}
    <tr>
      <td>{{ render_client_id(client) }}</td>
      <td class="nowrap"><time datetime="{{ client.registered_at.isoformat() }}" title="{{ client.registered_at|datetimeformat }}">{{ _('since') }} {{ client.registered_at|timedeltaformat }}</time></td>
      <td class="centered">{{ render_interactivity(client) }}</td>
      <td>{{ client.location|fallback }}<br>{{ client.description|fallback }}</td>
    </tr>
    {%- endfor %}
  </tbody>
</table>
{%- endif %}

{%- if deleted_clients %}
<h2 class="title">{{ render_authority_status_icon('deleted') }} {{ _('Deleted Clients') }} {{ render_extra_in_heading(deleted_clients|length) }}</h2>

<table class="itemlist is-vcentered is-wide">
  <thead>
    <tr>
      <th>{{ _('ID') }}</th>
      <th class="nowrap">{{ _('Registered at') }}</th>
      <th class="centered">{{ _('Interactivity') }}<br></th>
      <th>{{ _('Location') }}<br>{{ _('Description') }}</th>
    </tr>
  </thead>
  <tbody>
    {%- for client in deleted_clients|sort(attribute='registered_at', reverse=True) %}
    <tr>
      <td>{{ render_client_id(client) }}</td>
      <td><time datetime="{{ client.registered_at.isoformat() }}" title="{{ client.registered_at|datetimeformat }}">{{ _('since') }} {{ client.registered_at|timedeltaformat }}</time></td>
      <td class="centered">{{ render_interactivity(client) }}</td>
      <td>{{ client.location|fallback }}<br>{{ client.description|fallback }}</td>
    </tr>
    {%- endfor %}
  </tbody>
</table>
{%- endif %}

{%- if not pending_clients and not approved_clients and not deleted_clients %}
<div class="box">
  <div class="dimmed-box centered">{{ _('No clients registered.') }}</div>
</div>
{%- endif %}

{%- endblock %}
